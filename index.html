<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood Visualization Dashboard - Real-time Risk Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            /* Fix for white dropdowns: tells browser to use dark system UI */
            color-scheme: dark;
            
            --bg-dark: #06090f;
            --bg-card: rgba(20, 24, 36, 0.7);
            --bg-elevated: rgba(26, 31, 46, 0.8);
            --accent-blue: #0099ff;
            --accent-cyan: #00fff5;
            --accent-warning: #ffb300;
            --accent-danger: #ff2d55;
            --text-primary: #f0f4f8;
            --text-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.08);
            --glow-blue: rgba(0, 153, 255, 0.3);
            --glow-cyan: rgba(0, 255, 245, 0.2);
            --glass-blur: blur(12px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.5;
            background-attachment: fixed;
        }
        
        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 153, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 153, 255, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            animation: gridMove 30s linear infinite;
            z-index: -1;
            pointer-events: none;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(60px, 60px); }
        }
        
        .container {
            max-width: 1700px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Header Section */
        header {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px 40px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .header-content h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, var(--accent-cyan));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            opacity: 0.8;
            margin-top: 4px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 45, 85, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 45, 85, 0.2);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-danger);
        }

        .live-indicator .dot {
            width: 8px;
            height: 8px;
            background: var(--accent-danger);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--accent-danger);
            animation: blink 1.5s infinite;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        /* Dashboard Stats */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .status-card {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        
        .status-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-blue);
        }

        .status-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
            opacity: 0.5;
        }
        
        .status-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: #fff;
        }

        /* Layout Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 380px 1fr 380px;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .panel {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
        }
        
        .icon {
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 153, 255, 0.15);
            border: 1px solid rgba(0, 153, 255, 0.3);
            border-radius: 8px;
            font-size: 16px;
        }
        
        /* Map Area */
        .map-wrapper {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
        }

        #map {
            height: 100%;
            min-height: 500px;
        }

        /* Controls */
        .controls-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-group label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        select {
            width: 100%;
            padding: 12px 16px;
            background: #1a1f2e; /* Solid background for dropdown */
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: inherit;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            cursor: pointer;
        }

        /* Explicitly style options for browsers that support it */
        select option {
            background-color: #1a1f2e;
            color: var(--text-primary);
            padding: 10px;
        }

        select:focus {
            outline: 2px solid var(--accent-blue);
            border-color: transparent;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            appearance: none;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent-cyan);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--accent-cyan);
            transition: 0.2s;
        }
        
        .slider-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--accent-cyan);
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border: none;
            border-radius: 12px;
            color: #000;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px var(--glow-blue);
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 30px var(--glow-cyan);
        }
        
        /* Charts & Visuals */
        .chart-container {
            flex-grow: 1;
            position: relative;
            min-height: 220px;
            margin-top: 10px;
        }
        
        .legend {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.03);
            padding: 8px;
            border-radius: 8px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .risk-low { background: #10b981; }
        .risk-medium { background: #f59e0b; }
        .risk-high { background: #f97316; }
        .risk-extreme { background: #ef4444; }
        
        .info-box {
            background: rgba(0, 153, 255, 0.05);
            border-left: 3px solid var(--accent-blue);
            padding: 16px;
            border-radius: 0 12px 12px 0;
            font-size: 0.9rem;
            margin-top: 15px;
            line-height: 1.6;
        }

        .info-box.danger { border-left-color: var(--accent-danger); background: rgba(255, 45, 85, 0.05); }
        .info-box.warning { border-left-color: var(--accent-warning); background: rgba(255, 179, 0, 0.05); }

        /* Secondary Grid */
        .secondary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        /* Leaflet Tweaks */
        .leaflet-container { background: #111; }
        .leaflet-bar a { background: #222; color: #fff; border-bottom-color: #333; }
        .leaflet-popup-content-wrapper { background: #1a1f2e; color: #fff; border: 1px solid #333; }
        .leaflet-popup-tip { background: #1a1f2e; }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-grid { grid-template-columns: 1fr; }
            .main-grid > .panel:nth-child(1) { order: 2; }
            .main-grid > .panel:nth-child(2) { order: 1; }
            .main-grid > .panel:nth-child(3) { order: 3; }
        }

        @media (max-width: 900px) {
            .status-bar { grid-template-columns: 1fr 1fr; }
            .secondary-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Flood Risk Visualization</h1>
                <p class="subtitle">Hydrological simulation & predictive risk modeling system v2.4</p>
            </div>
            <div class="live-indicator">
                <span class="dot"></span>
                LIVE SYSTEM ACTIVE
            </div>
        </header>
        
        <div class="status-bar">
            <div class="status-card">
                <div class="status-label">Hazard Level</div>
                <div class="status-value" id="riskLevel">SECURE</div>
            </div>
            <div class="status-card">
                <div class="status-label">Intensity (mm)</div>
                <div class="status-value" id="rainfallValue">0</div>
            </div>
            <div class="status-card">
                <div class="status-label">Depth (m)</div>
                <div class="status-value" id="waterLevel">0.00</div>
            </div>
            <div class="status-card">
                <div class="status-label">Impact Zone (km¬≤)</div>
                <div class="status-value" id="affectedArea">0.00</div>
            </div>
        </div>
        
        <div class="main-grid">
            <!-- Sidebar: Controls -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><span class="icon">‚öôÔ∏è</span>Configuration</h2>
                </div>
                
                <div class="controls-container">
                    <div class="control-group">
                        <label>Target Region</label>
                        <select id="stateSelect">
                            <option value="">Querying states...</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>District Sub-Division</label>
                        <select id="districtSelect">
                            <option value="">Select state...</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Temporal Context</label>
                        <select id="monthSelect">
                            <option value="June">June</option>
                            <option value="July" selected>July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Precipitation Factor</label>
                        <input type="range" id="rainfallSlider" min="50" max="300" value="100" step="10">
                        <div class="slider-meta">
                            <span>50%</span>
                            <span id="sliderValue">100%</span>
                            <span>300%</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>Forecasting Horizon</label>
                        <input type="range" id="timeSlider" min="0" max="72" value="0" step="1">
                        <div class="slider-meta">
                            <span>0H</span>
                            <span id="timeValue">0 HRS</span>
                            <span>72H</span>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="runSimulation()">EXECUTE SIMULATION</button>
                </div>
                
                <div class="legend">
                    <div class="legend-item"><div class="legend-color risk-low"></div>Low</div>
                    <div class="legend-item"><div class="legend-color risk-medium"></div>Moderate</div>
                    <div class="legend-item"><div class="legend-color risk-high"></div>High</div>
                    <div class="legend-item"><div class="legend-color risk-extreme"></div>Critical</div>
                </div>
            </div>
            
            <!-- Center: Map -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><span class="icon">üõ∞Ô∏è</span>Spatial Inundation</h2>
                </div>
                <div class="map-wrapper">
                    <div id="map"></div>
                </div>
                <div class="info-box" id="mapInfo">
                    Select telemetry source and click Execute to start.
                </div>
            </div>

            <!-- Right: Assessment -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><span class="icon">üìà</span>Probability Matrix</h2>
                </div>
                <div id="riskAssessment">
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
                <div class="info-box" style="margin-top: 20px;">
                    <strong>Predictive Analytics:</strong>
                    Real-time data fusion combining historical rainfall with topographic slope analysis.
                </div>
            </div>
        </div>

        <div class="secondary-grid">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><span class="icon">üìä</span>Annual Rainfall Trend</h2>
                </div>
                <div class="chart-container">
                    <canvas id="rainfallChart"></canvas>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><span class="icon">‚è±Ô∏è</span>Hydrograph Timeline</h2>
                </div>
                <div class="chart-container">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Logic remains identical to preserve your variables and functionality
        let map, rainfallData, currentDistrict;
        let rainfallChart, timelineChart, riskChart;
        let floodLayers = [];
        
        async function initApp() {
            await loadRainfallData();
            initMap();
            initCharts();
            setupEventListeners();
        }
        
        async function loadRainfallData() {
            try {
                const response = await fetch('complete_rainfall_data.json');
                rainfallData = await response.json();
                populateStateDropdown();
            } catch (error) {
                rainfallData = getSampleData();
                populateStateDropdown();
            }
        }
        
        function getSampleData() {
            return [
                {
                    state: "ASSAM",
                    district: "CACHAR",
                    monthly: {January: 13.3, February: 50.2, March: 168.3, April: 262.5, May: 386.4, June: 532.1, July: 526.2, August: 470.8, September: 360.8, October: 182.4, November: 34.8, December: 11.4},
                    annual: 2999.2,
                    monsoon: 1889.9
                },
                {
                    state: "KERALA",
                    district: "IDUKKI",
                    monthly: {January: 13.2, February: 20.1, March: 63.8, April: 142.8, May: 285.6, June: 737.8, July: 770.2, August: 548.9, September: 288.4, October: 315.2, November: 185.1, December: 56.8},
                    annual: 3427.9,
                    monsoon: 2345.3
                }
            ];
        }
        
        function populateStateDropdown() {
            const stateSelect = document.getElementById('stateSelect');
            const states = [...new Set(rainfallData.map(d => d.state))].sort();
            stateSelect.innerHTML = '<option value="">-- SELECT STATE --</option>';
            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            });
        }
        
        function populateDistrictDropdown(state) {
            const districtSelect = document.getElementById('districtSelect');
            const districts = rainfallData.filter(d => d.state === state).map(d => d.district).sort();
            districtSelect.innerHTML = '<option value="">-- SELECT DISTRICT --</option>';
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }
        
        function initMap() {
            // Using a dark themed map provider
            map = L.map('map', { zoomControl: false }).setView([23.5, 78.5], 5);
            L.control.zoom({ position: 'bottomright' }).addTo(map);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CartoDB'
            }).addTo(map);
        }
        
        function initCharts() {
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.font.family = "'Outfit', sans-serif";
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, border: { display: false } },
                    x: { grid: { display: false }, border: { display: false } }
                }
            };
            
            const rainfallCtx = document.getElementById('rainfallChart').getContext('2d');
            rainfallChart = new Chart(rainfallCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Rainfall',
                        data: Array(12).fill(0),
                        backgroundColor: 'rgba(0, 153, 255, 0.4)',
                        borderColor: '#00fff5',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: chartOptions
            });
            
            const timelineCtx = document.getElementById('timelineChart').getContext('2d');
            timelineChart = new Chart(timelineCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 73}, (_, i) => i),
                    datasets: [{
                        data: [],
                        borderColor: '#00fff5',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(0, 255, 245, 0.05)'
                    }]
                },
                options: chartOptions
            });
            
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            riskChart = new Chart(riskCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Low', 'Med', 'High', 'Ext'],
                    datasets: [{
                        data: [100, 0, 0, 0],
                        backgroundColor: ['#10b981', '#f59e0b', '#f97316', '#ef4444'],
                        borderWidth: 0,
                        cutout: '75%'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, padding: 20 } } }
                }
            });
        }
        
        function setupEventListeners() {
            document.getElementById('stateSelect').addEventListener('change', (e) => {
                if (e.target.value) populateDistrictDropdown(e.target.value);
            });
            
            document.getElementById('districtSelect').addEventListener('change', (e) => {
                if (e.target.value) {
                    const state = document.getElementById('stateSelect').value;
                    currentDistrict = rainfallData.find(d => d.state === state && d.district === e.target.value);
                    updateRainfallChart();
                }
            });
            
            document.getElementById('rainfallSlider').addEventListener('input', (e) => {
                document.getElementById('sliderValue').textContent = e.target.value + '%';
            });
            
            document.getElementById('timeSlider').addEventListener('input', (e) => {
                document.getElementById('timeValue').textContent = e.target.value + ' HRS';
                updateFloodVisualization(parseInt(e.target.value));
            });
        }
        
        function updateRainfallChart() {
            if (!currentDistrict) return;
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            rainfallChart.data.datasets[0].data = months.map(m => currentDistrict.monthly[m]);
            rainfallChart.update();
            
            document.getElementById('mapInfo').innerHTML = `
                <strong>Station ID: ${currentDistrict.district.toUpperCase()}</strong><br>
                Annual: ${currentDistrict.annual.toFixed(1)}mm | Monsoon: ${currentDistrict.monsoon.toFixed(1)}mm
            `;
        }
        
        function runSimulation() {
            if (!currentDistrict) return;
            
            const month = document.getElementById('monthSelect').value;
            const intensity = parseInt(document.getElementById('rainfallSlider').value) / 100;
            const baseRainfall = currentDistrict.monthly[month];
            const adjustedRainfall = baseRainfall * intensity;
            
            const waterLevel = calculateWaterLevel(adjustedRainfall);
            const affectedArea = calculateAffectedArea(waterLevel);
            const riskLevel = calculateRiskLevel(adjustedRainfall, waterLevel);
            
            document.getElementById('rainfallValue').textContent = adjustedRainfall.toFixed(0);
            document.getElementById('waterLevel').textContent = waterLevel.toFixed(2);
            document.getElementById('affectedArea').textContent = affectedArea.toFixed(2);
            document.getElementById('riskLevel').textContent = riskLevel;
            document.getElementById('riskLevel').style.color = getRiskColor(riskLevel);
            
            updateTimelineChart(adjustedRainfall);
            updateRiskAssessment(riskLevel, adjustedRainfall);
            updateMapFloodZones(waterLevel);
            updateInfoBox(riskLevel, adjustedRainfall, waterLevel);
        }
        
        function calculateWaterLevel(rainfall) {
            return 0.5 + (rainfall * 0.6 / 100);
        }
        
        function calculateAffectedArea(waterLevel) {
            return waterLevel * 12 + Math.random() * 5;
        }
        
        function calculateRiskLevel(rainfall, waterLevel) {
            if (waterLevel > 4 || rainfall > 500) return 'CRITICAL';
            if (waterLevel > 2.5 || rainfall > 350) return 'HIGH';
            if (waterLevel > 1.5 || rainfall > 200) return 'MODERATE';
            return 'SECURE';
        }
        
        function getRiskColor(risk) {
            const colors = { 'SECURE': '#10b981', 'MODERATE': '#f59e0b', 'HIGH': '#f97316', 'CRITICAL': '#ef4444' };
            return colors[risk] || '#fff';
        }
        
        function updateTimelineChart(rainfall) {
            const hours = 72;
            const data = [];
            for (let i = 0; i <= hours; i++) {
                const progress = i / hours;
                const peak = 0.7;
                let level = progress < peak ? (rainfall / 100) * (progress / peak) * (1 + Math.sin(progress * Math.PI)) : (rainfall / 100) * (1 - (progress - peak) / (1 - peak)) * 0.8;
                data.push(Math.max(0, level + Math.random() * 0.3));
            }
            timelineChart.data.datasets[0].data = data;
            timelineChart.update();
        }
        
        function updateRiskAssessment(riskLevel, rainfall) {
            const riskValues = { 'SECURE': [80, 15, 4, 1], 'MODERATE': [30, 50, 15, 5], 'HIGH': [10, 25, 45, 20], 'CRITICAL': [5, 10, 25, 60] };
            riskChart.data.datasets[0].data = riskValues[riskLevel] || [100, 0, 0, 0];
            riskChart.update();
        }
        
        function updateMapFloodZones(waterLevel) {
            floodLayers.forEach(layer => map.removeLayer(layer));
            floodLayers = [];
            const center = [23.5 + (Math.random() - 0.5) * 5, 78.5 + (Math.random() - 0.5) * 10];
            map.flyTo(center, 10, { duration: 1.5 });
            
            const zones = [
                { radius: waterLevel * 2000, color: '#ef4444', opacity: 0.4 },
                { radius: waterLevel * 4000, color: '#f97316', opacity: 0.2 },
                { radius: waterLevel * 6000, color: '#f59e0b', opacity: 0.1 }
            ];
            
            zones.forEach(zone => {
                const circle = L.circle(center, {
                    radius: zone.radius,
                    color: zone.color,
                    fillColor: zone.color,
                    fillOpacity: zone.opacity,
                    weight: 1
                }).addTo(map);
                floodLayers.push(circle);
            });
            
            const marker = L.circleMarker(center, { radius: 8, color: '#00fff5', fillColor: '#00fff5', fillOpacity: 0.8 }).addTo(map);
            marker.bindPopup(`<b>Target Node: ${currentDistrict.district}</b><br>Hydraulic Depth: ${waterLevel.toFixed(2)}m`).openPopup();
            floodLayers.push(marker);
        }
        
        function updateFloodVisualization(hours) {
            if (floodLayers.length === 0) return;
            const progress = hours / 72;
            floodLayers.forEach((layer, index) => {
                if (layer instanceof L.Circle && !(layer instanceof L.CircleMarker)) {
                    layer.setRadius(layer.options.radius * (0.8 + progress * 0.4));
                }
            });
        }
        
        function updateInfoBox(riskLevel, rainfall, waterLevel) {
            const infoBox = document.getElementById('mapInfo');
            const type = riskLevel === 'CRITICAL' || riskLevel === 'HIGH' ? 'danger' : riskLevel === 'MODERATE' ? 'warning' : '';
            infoBox.className = `info-box ${type}`;
            infoBox.innerHTML = `
                <strong>Analysis for ${currentDistrict.district}:</strong><br>
                Hazard: ${riskLevel} | Rainfall: ${rainfall.toFixed(1)}mm | Level: ${waterLevel.toFixed(2)}m
            `;
        }
        
        window.addEventListener('load', initApp);
    </script>
</body>
</html>